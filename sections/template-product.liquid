<!-- Swiper CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/swiper@7/swiper-bundle.min.css" />
<script src="https://unpkg.com/swiper@7/swiper-bundle.min.js"></script>

{% assign selected_variant = product.selected_or_first_available_variant %}

<style>
  .swiper-button-prev,
  .swiper-button-next {
    color: #222;
    top: 50%;
    transform: translateY(-50%);
  }

  .swiper-pagination-bullet {
    background: #ccc;
  }

  .swiper-pagination-bullet-active {
    background: #000 !important;
  }
</style>
<a href="{{ routes.root_url }}"
  class="inline-flex items-center gap-2 border border-gray-300 text-gray-700 hover:bg-gray-100 hover:text-gray-900 rounded-full px-5 py-2 transition duration-300">
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
    class="w-4 h-4">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
  </svg>
  Back
</a>
<div class="max-w-7xl mx-auto my-12 px-6">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-10">

    <!-- ðŸ–¼ï¸ Product Media -->
    <div class="product--medias">
      <!-- Desktop View -->
      <div class="hidden md:grid grid-cols-2 gap-4">
        {% for media in product.media %}
        <div
          class="overflow-hidden rounded-2xl border border-gray-200 hover:shadow-lg transition-transform duration-300 hover:scale-[1.02]">
          {% render 'product-media'
          , media: media %}
        </div>
        {% endfor %}
      </div>

      <!-- Mobile Slider -->
      <div class="md:hidden">
        <div class="swiper h-[420px] rounded-xl overflow-hidden">
          <div class="swiper-wrapper">
            {% for media in product.media %}
            <div class="swiper-slide">
              {% render 'product-media'
              , media: media %}
            </div>
            {% endfor %}
          </div>

          <div class="swiper-pagination"></div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
        </div>
      </div>
    </div>

    <!-- ðŸ›ï¸ Product Information -->
    <div class="product--information sticky top-10 bg-white p-4 md:p-6 rounded-xl shadow-sm space-y-6">
      {% form 'product'
      , product %}
      <input type="hidden" name="id" value="{{ selected_variant.id }}">

      {% for block in section.blocks %}
      {% case block.type %}

      {% when 'vendor' %}
      <p class="text-sm uppercase tracking-wide text-gray-500">{{ product.vendor }}</p>

      {% when 'title' %}
      <h1 class="text-3xl md:text-4xl font-bold text-gray-900 leading-snug">{{ product.title }}</h1>

      {% when 'price' %}
      <div class="flex items-center gap-3 mt-2">
        <span id="compare-price" class="text-lg text-gray-400 line-through">
          {% if selected_variant.compare_at_price > selected_variant.price %}
          {{ selected_variant.compare_at_price | money }}
          {% endif %}
        </span>

        <span id="main-price" class="text-2xl font-semibold text-gray-900">
          {{ selected_variant.price | money }}
        </span>

        <span id="sale-badge" class="text-xs bg-red-500 text-white px-3 py-1 rounded-full uppercase">
          {% if selected_variant.compare_at_price > selected_variant.price %}
          Sale
          {% endif %}
        </span>
      </div>


      {% when 'variant_selector' %}
      {% unless product.has_only_default_variant %}
      <div class="mt-6 space-y-6">

        {% for option in product.options_with_values %}
        <div class="space-y-2">
          <p class="text-sm font-semibold text-gray-800">
            {{ option.name }}
          </p>

          <div class="flex flex-wrap gap-2">
            {% for value in option.values %}
            <button type="button" class="variant-button border px-4 py-2 rounded-full text-sm transition
                {% if option.selected_value == value %}
                  bg-gray-900 text-white border-gray-900
                {% else %}
                  border-gray-300 text-gray-700 hover:border-gray-500
                {% endif %}" data-option-position="{{ option.position }}" data-option-value="{{ value | escape }}">
              {{ value }}
            </button>
            {% endfor %}
          </div>

        </div>
        {% endfor %}

        <!-- Hidden Selects (Needed for Shopify form submission) -->
        {% for option in product.options_with_values %}
        <select name="options[{{ option.name | escape }}]" class="hidden variant-hidden-select"
          data-option-position="{{ option.position }}">
          {% for value in option.values %}
          <option value="{{ value | escape }}" {% if option.selected_value==value %} selected {% endif %}>
            {{ value }}
          </option>
          {% endfor %}
        </select>
        {% endfor %}

      </div>
      {% endunless %}

      {% when 'quantity' %}
      <div class="mt-6">
        <label for="Quantity-{{ section.id }}" class="block text-sm font-medium text-gray-700 mb-2">Quantity</label>
        <div class="flex items-center border border-gray-300 rounded-lg w-36">
          <button type="button" class="w-10 h-10 flex items-center justify-center text-gray-600 hover:bg-gray-100"
            onclick="updateQuantity(-1)">âˆ’</button>
          <input type="number" name="quantity" id="Quantity-{{ section.id }}" value="1" min="1"
            class="w-full text-center font-medium text-gray-900 outline-none">
          <button type="button" class="w-10 h-10 flex items-center justify-center text-gray-600 hover:bg-gray-100"
            onclick="updateQuantity(1)">+</button>
        </div>
      </div>

      {% when 'description' %}
      <div class="mt-8 bg-gray-50 border border-gray-200 rounded-xl p-6 shadow-sm">
        <h2 class="text-2xl font-semibold text-gray-900 mb-4 border-b border-gray-300 pb-2">
          Product Description
        </h2>
        <div class="text-gray-700 leading-relaxed text-base space-y-3">
          {{ product.description }}
        </div>
      </div>


      {% when 'checkout_buttons' %}
      <div class="mt-8 space-y-3">
        <button type="submit" name="add"
          class="w-full py-4 bg-gray-900 text-white text-lg font-semibold rounded-lg hover:bg-gray-800 transition disabled:opacity-50 flex items-center justify-center gap-2"
          {% unless selected_variant.available %} disabled {% endunless %}>
          {% if selected_variant.available %}
          <!-- Cart Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437m0 
                    0L6.75 14.25m-1.644-9.978h13.146c.954 0 
                    1.68.88 1.49 1.81l-1.2 6A1.5 1.5 0 
                  0117.07 14.25H6.75m0 0a1.5 1.5 0 
                  100 3h10.5a1.5 1.5 0 100-3H6.75z" />
          </svg>
          Add to Cart
          {% else %}
          Sold Out
          {% endif %}
        </button>
        {{ form | payment_button }}
      </div>


      {% endcase %}
      {% endfor %}
      {% endform %}
    </div>
  </div>
</div>

<script>
  // Swiper Init
  const swiper = new Swiper('.swiper', {
    pagination: { el: '.swiper-pagination', clickable: true },
    navigation: { prevEl: '.swiper-button-prev', nextEl: '.swiper-button-next' },
  });

  // Quantity Buttons
  function updateQuantity(change) {
    const input = document.querySelector('#Quantity-{{ section.id }}');
    let value = parseInt(input.value || 1);
    value = Math.max(1, value + change);
    input.value = value;
  }
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const productForm = document.querySelector('form[action="/cart/add"]');
    const variantSelectors = productForm.querySelectorAll('select[name^="options["]');
    const variants = {{ product.variants | json
  }};
  const variantInput = productForm.querySelector('input[name="id"]');

  function updateVariant() {
    const selectedOptions = Array.from(variantSelectors).map(select => select.value);
    const matchedVariant = variants.find(variant => {
      return JSON.stringify(variant.options) === JSON.stringify(selectedOptions);
    });

    if (matchedVariant) {
      variantInput.value = matchedVariant.id;
    }
  }

  variantSelectors.forEach(select => {
    select.addEventListener('change', updateVariant);
  });
  });
</script>


{% schema %}
{
"name": "Product Page",
"blocks": [
{
"type": "vendor",
"name": "Vendor",
"limit": 1
},
{
"type": "title",
"name": "Title",
"limit": 1
},
{
"type": "price",
"name": "Price",
"limit": 1
},
{
"type": "variant_selector",
"name": "Variant Selector",
"limit": 1
}, {
"type": "quantity",
"name": "Quantity",
"limit": 1
}, {
"type": "description",
"name": "Description",
"limit": 1
}, {
"type": "checkout_buttons",
"name": "Checkout Buttons",
"limit": 1
}
]
}
{% endschema %}

<script>
  document.addEventListener("DOMContentLoaded", () => {

    // Update hidden selects when pill buttons are clicked
    document.querySelectorAll(".variant-button").forEach(button => {
      button.addEventListener("click", () => {
        const optionPos = button.dataset.optionPosition;
        const optionVal = button.dataset.optionValue;

        // Unselect existing active button in this group
        document.querySelectorAll(`.variant-button[data-option-position="${optionPos}"]`)
          .forEach(btn => btn.classList.remove("bg-gray-900", "text-white", "border-gray-900"));

        // Activate clicked button
        button.classList.add("bg-gray-900", "text-white", "border-gray-900");

        // Update hidden select
        let hiddenSelect = document.querySelector(`select.variant-hidden-select[data-option-position="${optionPos}"]`);
        if (hiddenSelect) {
          hiddenSelect.value = optionVal;
          hiddenSelect.dispatchEvent(new Event("change"));
        }
      });
    });

  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {

    const productForm = document.querySelector('form[action="/cart/add"]');
    const variantSelectors = productForm.querySelectorAll('select[name^="options["]');
    const variants = {{ product.variants | json
  }};
  const variantInput = productForm.querySelector('input[name="id"]');

  // Price elements
  const mainPriceEl = document.getElementById("main-price");
  const comparePriceEl = document.getElementById("compare-price");
  const saleBadgeEl = document.getElementById("sale-badge");

  function updateVariant() {
    const selectedOptions = Array.from(variantSelectors).map(select => select.value);

    const matchedVariant = variants.find(v =>
      JSON.stringify(v.options) === JSON.stringify(selectedOptions)
    );

    if (matchedVariant) {
      // Update variant ID for Add to Cart
      variantInput.value = matchedVariant.id;

      // Update main price
      mainPriceEl.innerHTML = Shopify.formatMoney(matchedVariant.price);

      // Compare price update
      if (matchedVariant.compare_at_price > matchedVariant.price) {
        comparePriceEl.innerHTML = Shopify.formatMoney(matchedVariant.compare_at_price);
        comparePriceEl.style.display = "inline-block";
        saleBadgeEl.style.display = "inline-block";
      } else {
        comparePriceEl.style.display = "none";
        saleBadgeEl.style.display = "none";
      }
    }
  }

  variantSelectors.forEach(select => {
    select.addEventListener("change", updateVariant);
  });

});
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {

    const productForm = document.querySelector('form[action="/cart/add"]');
    const variantSelectors = productForm.querySelectorAll('select[name^="options["]');
    const variants = {{ product.variants | json
  }};
  const variantInput = productForm.querySelector('input[name="id"]');

  // Price elements
  const mainPriceEl = document.getElementById("main-price");
  const comparePriceEl = document.getElementById("compare-price");
  const saleBadgeEl = document.getElementById("sale-badge");

  // -------------------------------
  // MAIN UPDATE VARIANT FUNCTION
  // -------------------------------
  function updateVariant() {
    const selectedOptions = Array.from(variantSelectors).map(select => select.value);

    const matchedVariant = variants.find(v =>
      JSON.stringify(v.options) === JSON.stringify(selectedOptions)
    );

    if (matchedVariant) {
      // Update variant ID
      variantInput.value = matchedVariant.id;

      // Update main price
      mainPriceEl.innerHTML = Shopify.formatMoney(matchedVariant.price);

      // Compare price update
      if (matchedVariant.compare_at_price > matchedVariant.price) {
        comparePriceEl.innerHTML = Shopify.formatMoney(matchedVariant.compare_at_price);
        comparePriceEl.style.display = "inline-block";
        saleBadgeEl.style.display = "inline-block";
      } else {
        comparePriceEl.style.display = "none";
        saleBadgeEl.style.display = "none";
      }
    }
  }

  // Call update when hidden selects change
  variantSelectors.forEach(select => {
    select.addEventListener("change", updateVariant);
  });

  // ---------------------------------
  // PILL BUTTON CLICK â†’ UPDATE PRICE
  // ---------------------------------
  document.querySelectorAll(".variant-button").forEach(button => {
    button.addEventListener("click", () => {
      const optionPos = button.dataset.optionPosition;
      const optionVal = button.dataset.optionValue;

      // Remove active state
      document.querySelectorAll(`.variant-button[data-option-position="${optionPos}"]`)
        .forEach(btn => btn.classList.remove("bg-gray-900", "text-white", "border-gray-900"));

      // Add active state
      button.classList.add("bg-gray-900", "text-white", "border-gray-900");

      // Update hidden select
      let hiddenSelect = document.querySelector(`select[data-option-position="${optionPos}"]`);
      if (hiddenSelect) {
        hiddenSelect.value = optionVal;
        hiddenSelect.dispatchEvent(new Event("change"));
      }

      // ðŸ”¥ Price updates here
      updateVariant();
    });
  });

});
</script>
